<html lang="en" style="overflow-y: scroll;">

  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <!-- Style Sheets -->
    <link rel="stylesheet" href="/stylesheet.css"/>
    <link rel="stylesheet" href="/bootstrap.css"/>
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>
  <div id="myProgress">
    <div style="height:2px;" id="myBar"></div>
  </div>
  <header class="header" style="background-color:#333E47;">
    <div class=frame>
      <span class="logoImg"></span><img srcset="/zebra.png" alt="logo"/>
    </div>
    <div class="header_text">
      <h2 class="header_h1" style="color:#ffffff; padding-left:20px;">Innovation Tracker</h2>
    </div>
  </header>

  <body>
    <div style="background-color:#878783 ; height:2px;"></div>
    <br>
    <br>
    <div style="width:100%; text-align:center;">
      <!--Center Piece with rounded edges -->
      <div style="width:60%; margin:auto; border: #333E47 1px solid; border-radius:15px;">
        <br>
        <!--Content Div with spacing from edges -->
        <div style="width:80%; margin:auto;">
          <!--Unorderd list of header tabs -->
          <ul class="nav nav-tabs" id="headerTabs" role="tablist">
            <!-- Add Points Tab -->
            <li id="add_points_tab" class="nav-item active">
              <a class="nav-link" id="addPoints-tab" data-toggle="tab" href="#add_points" role="tab" aria-controls="addPoints" aria-selected="true">Add Points</a>
            </li>
            <!-- Viewing Points Tab -->
            <li id="view_points_tab" class="nav-item">
              <a class="nav-link" id="viewPoints-tab" data-toggle="tab" href="#view_points" role="tab" aria-controls="viewPoints" aria-selected="false">View Points</a>
            </li>
            <!-- Leaderboard Tab -->
            <li id="leaderboard_tab" class="nav-item">
              <a class="nav-link" id="leaderboard-tab" data-toggle="tab" href="#leaderboard" role="tab" aria-controls="leaderboard" aria-selected="false">Leaderboard</a>
            </li>
          </ul>
          <!-- Div containing the content -->
          <div class="tab-content" id="headerTabContent">
            <!-- Add Points tab content tab -->
            <div class="tab-pane fade active in " id="add_points" role="tabpanel" style="height:43%;" aria-labelledby="addPoints-tab" >
              <div style="width:100%; margin:0 auto;">
                <br>
                  <div class="form-row">
                    <div class="form-group col-md-6" style="text-align:left;">
                      <label for="core_id">Core ID:</label>
                      <input type="text" class="form-control" id="core_id" name="core_id">
                    </div>
                    <div class="form-group col-md-6" style="text-align:left;">
                      <label style="visibility: hidden;" for="valid">Valid</label>
                      <input style="visibility: hidden; border:0; pointer-events: none;" type="text" class="form-control noshadow" id="valid" name="valid">
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group col-md-6" style="text-align:left;">
                      <label for="name">Name:</label>
                      <input type="text" class="form-control" id="name" name="name" readonly>
                    </div>
                    <div class="form-group col-md-6" style="text-align:left;">
                      <label for="manager">Manager:</label>
                      <input type="text" class="form-control" id="manager" name="manager" readonly>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group col-md-12" style="text-align:left;">
                      <label for="accomplishment">Select an Accomplishment</label>
                      <select class="form-control" id="accomplishment" name="accomplishment">
                        <option value="1">Choose your Acomplisment</option>
                        <option value="2">Identify a meaningful problem that needs a solution (1)</option>
                        <option value="3">Identify a new product feature for the backlog (1)</option>
                        <option value="4">Attend a Lunch and Learn (1)</option>
                        <option value="5">Submit abstract for ZTS Expo or Srjana (1)</option>
                        <option value="6">Attend a readout from a customer visit (1)</option>
                        <option value="7">Attend JDM Expo, Innovation showcase, Intern project review (1)</option>
                        <option value="8">Peer review an IP disclosure - witness, read and understand (1)</option>
                        <option value="9">Join Eto Techspresso event (1)</option>
                        <option value="10">Take part in brain storming session (2)</option>
                        <option value="11">Help someone get their first patent disclosure submitted (2)</option>
                        <option value="12">Solve a problem and implement the solution (2)</option>
                        <option value="13">Mentoring inventors for success (2)</option>
                        <option value="14">Teach a class, lead a Lunch and Learn, lead a techtalk, or developer conf (2)</option>
                        <option value="15">Organize and run a brainstorming session (2)</option>
                        <option value="16">Visit a customer and present findings (2)</option>
                        <option value="17">Supervise a summer intern on one of their projects (2)</option>
                        <option value="18">Collaborate across BU's for Differentiation and efficency opportunities (2)</option>
                        <option value="19">Submit a peer reviewed IP disclosure (4)</option>
                        <option value="20">Patent Committee decides to "pursue" your submission - Phase 2 (4)</option>
                        <option value="21">[CUSTOM] (1)</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group col-md-12" style="text-align:left;">
                      <label for="desc">Description</label>
                      <textarea style="resize:none;" class="form-control" id="desc" name="desc" rows="3" maxlength="300"></textarea>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12">
                      <button type="submit" onclick="addPoints()" class="btn btn-primary">Submit</button>
                    </div>
                  </div>
                  <!-- <div class="form-row">
                    <div class="form-group col-md-12" style="text-align:left;">
                      <input type="submit" onclick="addPoints()" class="btn btn-primary"></input>
                    </div>
                  </div> -->
                  <br>
              </div>
            </div>

            <!-- View Points tab content tab -->
            <div class="tab-pane fade" id="view_points" style="min-height:43%;" role="tabpanel" aria-labelledby="viewPoints-tab">
              <br>
              <div class="form-row">
                <div class="form-group col-md-6" style="text-align:left;">
                  <label for="core_id_view">Core ID:</label>
                  <input type="text" class="form-control" id="core_id_view" name="core_id_view">
                </div>
                <div class="form-group col-md-6" style="text-align:left;">
                  <label for="periods">Choose a period:</label>
                  <select class="form-control" id="periods" name="periods"></select>
                </div>
              </div>
              <br>
              <div class="form-row">
                <div class="form-group col-md-12">
                  <a class="btn btn-primary" onclick="viewPoints()" id="viewPointButton" type="submit">Submit</a>
                </div>
              </div>
              <br><br><br>

              <div id="accordion">

                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <a class="btn btn-link" id="btnCollapseOne" style="border:solid black 1px; width:100%; color:black; visibility: hidden;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        Your Accomplishments
                      </a>
                    </h5>
                  </div>

                  <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body" style="visibility: hidden; border:#333 1px solid; text-align:center;" id="userTable"> <!-- MAKE THIS THE SAME AS THE OTHER TABLES -->
                      <!--ADD A RAISED TABLE HERE -->
                    </div>
                  </div>
                </div>

                <div class="card">
                  <div class="card-header" id="headingTwo">
                    <h5 class="mb-0">
                      <a class="btn btn-link collapsed" id="btnCollapseTwo" style="border:solid black 1px; width:100%; color:black; visibility: hidden;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Your Group
                      </a>
                    </h5>
                  </div>
                  <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body">

                      <!-- Below is the div that contains the list of employees who are under the same manager -->
                      <div class="raisedBox" style="visibility: hidden; border:#333 1px solid;" id="groupList"></div>

                    </div>
                  </div>
                </div>

                <div class="card">
                  <div class="card-header" id="headingThree">
                    <h5 class="mb-0">
                      <a class="btn btn-link collapsed" id="btnCollapseThree" style="border:solid black 1px; width:100%; color:black; visibility: hidden;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        Your Employees
                      </a>
                    </h5>
                  </div>
                  <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                    <div class="card-body">

                      <!-- Below is the div that contains the list of employees for the entered manager -->
                      <div class="raisedBox" style="visibility: hidden; border:#333 1px solid;" id="employeeList"></div>

                      <br>

                      <!-- Below is the button and div that correspond to the pie chart -->
                      <button style="visibility: hidden;" type="Button" class="btn btn-primary" data-toggle="modal" data-target="#myChart" id="chartDisplayButton">Display Chart</button>
                      <div class="modal fade" id="myChart" role="dialog">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                              <h4 class="modal-title">Below is the graph representing your employees progress.</h4>
                            </div>
                            <div class="modal-body">
                              <div id="pieChart" style="height: 0; width: 100%; visibility:hidden;"></div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>

              </div>
              <br><br><br><br>
            </div>

            <!-- Leaderboard tab content tab -->
            <div class="tab-pane fade" id="leaderboard" style="height:43%;" role="tabpanel" aria-labelledby="leaderboard-tab">
              <br>
              <h4>Below are the employees with the highest innovation score<h4>

                <!-- Below is the div that contains the employees with the top five innovation scores -->
              <div class="list-group" id="leaderboardTable"></div>

            </div>

          </div>
        </div>
      </div>
    </div>
    <br>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script>
  //Functions that occur when the window is reloaded - Loading the leaderboard and periods
  window.onload = function(){
    $.ajax({
      type: "POST",
      url: "/leaderboard",
      cache: false,
      success: function(response){
        document.getElementById("leaderboardTable").innerHTML= response
      }
    });

    $.ajax({
      type: "POST",
      url: "/getPeriods",
      cache: false,
      success: function(response){
        document.getElementById("periods").innerHTML = response;
      }
    });
  }

  //Checks when the user stops typing - Not currently used.
  /*
  var typingTimer;
  //Time waited before calling the function - milliseconds
  var doneTypingInterval = 500;
  //#core_id is the element id
  $('#core_id').keyup(function(){
    clearTimeout(typingTimer);
    if($('#core_id').val()){
      typingTimer = setTimeout(findManager, doneTypingInterval);
    }
  });
  */

  //Checks when a user leaves a specified element
  $('#core_id').focusout(function(){
    if($('#core_id').val()){
      typingTimer = setTimeout(findInformation, 0);
    }
  });

  //Function to find the manager and input the manager into the text box
  function findInformation(){
    //Loads the progress bar across the top of the screen
    var elem = document.getElementById("myBar");
    var width = 0;
    var id = setInterval(frame, 0);
    function frame() {
      if (width >= 100) {
        clearInterval(id);
        elem.style.width = "0%";
      } else {
        width++;
        elem.style.width = width + '%';
      }
    }
    //Performs the search
    var core_id = document.getElementById("core_id").value;
    $.ajax({
      type: "POST",
      url: "/findInformation",
      data: { "CORE_ID": core_id },
      cache: false,
      success: function(response){
        if(response[0] == "Invalid ID")
        {
          document.getElementById("valid").value = response[0];
          document.getElementById("valid").style.visibility = "visible";
          document.getElementById("name").value = "";
          document.getElementById("manager").value = "";
        }
        else{
          document.getElementById("valid").value = "";
          document.getElementById("valid").style.visibility = "hidden";
          document.getElementById("name").value = response[0];
          document.getElementById("manager").value = response[1];
        }

      }
    });
  }

  //On click action when the submit button is pressed in the view page
  function viewPoints(){
    //Temporarily disable the button so the user can't click it again
    var btn = document.getElementById("viewPointButton");
    btn.disabled = true;
    var core_id = document.getElementById("core_id_view").value;
    var period = document.getElementById("periods").value;
    $.ajax({
      type: "POST",
      url: "/viewPoints",
      data: { "CORE_ID": core_id,
              "PERIOD": period
      },
      cache: false,
      success: function(response){
        document.getElementById("userTable").innerHTML = response[0];
        document.getElementById("userTable").style.visibility ="visible";
        document.getElementById("btnCollapseOne").style.visibility ="visible";
        document.getElementById("collapseOne").style = "";

        $("#btnCollapseOne").attr("aria-expanded","true");
        $("#btnCollapseOne").removeClass("collapsed");
        $("#collapseOne").addClass("in");
        $("#collapseOne").attr("aria-expanded","true");

        $("#btnCollapseTwo").attr("aria-expanded","false");
        $("#btnCollapseTwo").addClass("collapsed");
        $("#collapseTwo").removeClass("in");
        $("#collapseTwo").attr("aria-expanded","false");

        $("#btnCollapseThree").attr("aria-expanded","false");
        $("#btnCollapseThree").addClass("collapsed");
        $("#collapseThree").removeClass("in");
        $("#collapseThree").attr("aria-expanded","false");

        if(response[1] != null){
          document.getElementById("groupList").innerHTML = response[1];
          document.getElementById("groupList").style.visibility ="visible";
          document.getElementById("btnCollapseTwo").style.visibility ="visible";
        }
        else{
          document.getElementById("groupList").innerHTML = "";
          document.getElementById("groupList").style.visibility ="hidden";
          document.getElementById("btnCollapseTwo").style.visibility ="hidden";
        }

        if(response[2] != null){
          document.getElementById("employeeList").innerHTML = response[2];
          document.getElementById("employeeList").style.visibility ="visible";
          document.getElementById("btnCollapseThree").style.visibility ="visible";
        }
        else{
          document.getElementById("employeeList").innerHTML = "";
          document.getElementById("employeeList").style.visibility ="hidden";
          document.getElementById("btnCollapseThree").style.visibility ="hidden";
        }
        var total = null;
        var incomplete = null;
        if(response[3] != null && response[4] != null){
          var incomplete = {y: response[3], label: "Points Needed: "};
          var total = {y: response[4], label: "Completed Points: "};
          var chart = new CanvasJS.Chart("pieChart", {
          	animationEnabled: true,
          	title: {
          		text: "Your Employees Progression"
          	},
          	data: [{
          		type: "pie",
          		startAngle: 240,
          		yValueFormatString: "##0 Points",
          		indexLabel: "{label} {y}",
          		dataPoints: [
                incomplete,
			          total
          		]
          	}]
          });
          chart.render();
          document.getElementById("chartDisplayButton").style.visibility ="visible";
          document.getElementById("pieChart").style.visibility ="visible";
          document.getElementById("pieChart").style.height ="400px";
        }
        else{
          document.getElementById("chartDisplayButton").style.visibility ="hidden";
          document.getElementById("pieChart").innerHTML = "";
          document.getElementById("pieChart").style.visibility ="hidden";
          document.getElementById("pieChart").style.height ="0px";
        }
        btn.disabled = false;
      }
    });
    return false;
  }

  function addPoints(){
    var core_id = document.getElementById("core_id").value;
    var accomplishment = document.getElementById("accomplishment").value;
    var description = document.getElementById("desc").value;
    var manager = document.getElementById("manager").value;
    $.ajax({
      type: "POST",
      url: "/addPoints",
      data: { "CORE_ID": core_id,
      "ACCOMPLISHMENT": accomplishment,
      "DESCRIPTION": description,
      "MANAGER": manager
     },
      cache: false,
      success: function(response){
        if(response == "Failure"){
          alert("Improper Inputs");
        }
        else{
          document.getElementById("add_points_tab").classList.remove('active');
          document.getElementById("view_points_tab").classList.add('active');
          document.getElementById("add_points").classList.remove('active');
          document.getElementById("add_points").classList.remove('in');
          document.getElementById("view_points").classList.add('active');
          document.getElementById("view_points").classList.add('in');
          document.getElementById("core_id_view").value = core_id;
          document.getElementById("viewPointButton").click();
        }
      }
    });
    return false;
  }

  function showMoreDetails(element){
    var id = element.id;
    document.getElementById("core_id_view").value = id;
    document.getElementById("viewPointButton").click();
  }

  </script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</html>
